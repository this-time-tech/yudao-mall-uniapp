import{_ as e}from"./s-empty.tLh6VNZu.js";import{z as s,s as t,v as l,c as o,r as a,e as c,f as i,w as d,u as r,j as n,g as u,k as f,p,t as m,l as _,m as g,F as k,A as h,B as x,C as b,i as y,D as v,E as C,G as w,H as S}from"./index-BYbmVHYF.js";import{_ as I}from"./su-number-box.BEEzrRQc.js";import{_ as M}from"./s-goods-item.B-P-c7gz.js";import{_ as j,S as G}from"./s-layout.B9Wf0wyf.js";import{S as $}from"./spu.DkDzSSyF.js";import{f as A}from"./useGoods.BAFIflfD.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.DEmjmW11.js";const L=B({__name:"cart",setup(B){s((e=>({"547dcd06":r(L)})));const L=t.$platform.navbar,T=t.$store("cart"),N=l({editMode:!1,list:o((()=>T.list)),selectedList:[],selectedIds:o((()=>T.selectedIds)),isAllSelected:o((()=>T.isAllSelected)),totalPriceSelected:o((()=>T.totalPriceSelected))});function V(e){T.selectSingle(e)}function E(){T.selectAll(!N.isAllSelected)}async function F(){const e=[];N.selectedList=N.list.filter((e=>N.selectedIds.includes(e.id))),N.selectedList.map((s=>{e.push({skuId:s.sku.id,count:s.count,cartId:s.id,categoryId:s.spu.categoryId})})),x(e)?t.$helper.toast("请先选择商品"):(await async function(e){const{data:s}=await $.getSpuListByIds(e.join(","));if(x(s))throw t.$helper.toast("未找到商品信息"),new Error("未找到商品信息");const l=s.map((e=>e.deliveryTypes));if(function(e){for(let s=0;s<e.length-1;s++){const t=e[s];for(let l=s+1;l<e.length;l++){const s=e[l];if(!t.some((e=>s.includes(e))))return!0}}return!1}(l))throw t.$helper.toast("选中商品支持的配送方式冲突，不允许提交"),new Error("选中商品支持的配送方式冲突，不允许提交")}(N.selectedList.map((e=>e.spu)).map((e=>e.id))),t.$router.go("/pages/order/confirm",{data:JSON.stringify({items:e})}))}async function P(){T.delete(N.selectedIds)}return(s,t)=>{const l=a(c("s-empty"),e),o=b,x=y,$=v,B=C,L=w,U=a(c("su-number-box"),I),z=a(c("s-goods-item"),M),D=a(c("su-fixed"),j),H=a(c("s-layout"),G);return n(),i(H,{bgStyle:{color:"#fff"},tabbar:"/pages/index/cart",title:"购物车"},{default:d((()=>[0===N.list.length?(n(),i(l,{key:0,icon:"/static/cart-empty.png",text:"购物车空空如也,快去逛逛吧~"})):u("",!0),N.list.length?(n(),i(x,{key:1,class:"cart-box ss-flex ss-flex-col ss-row-between"},{default:d((()=>[f(x,{class:"cart-header ss-flex ss-col-center ss-row-between ss-p-x-30"},{default:d((()=>[f(x,{class:"header-left ss-flex ss-col-center ss-font-26"},{default:d((()=>[p(" 共 "),f(o,{class:"goods-number ui-TC-Main ss-flex"},{default:d((()=>[p(m(N.list.length),1)])),_:1}),p(" 件商品 ")])),_:1}),f(x,{class:"header-right"},{default:d((()=>[N.editMode?(n(),i($,{key:0,class:"ss-reset-button",onClick:t[0]||(t[0]=e=>N.editMode=!1)},{default:d((()=>[p(" 取消 ")])),_:1})):(n(),i($,{key:1,class:"ss-reset-button ui-TC-Main",onClick:t[1]||(t[1]=e=>N.editMode=!0)},{default:d((()=>[p(" 编辑 ")])),_:1}))])),_:1})])),_:1}),f(x,{class:"cart-content ss-flex-1 ss-p-x-30 ss-m-b-40"},{default:d((()=>[(n(!0),_(k,null,g(N.list,(e=>(n(),i(x,{key:e.id,class:"goods-box ss-r-10 ss-m-b-14"},{default:d((()=>[f(x,{class:"ss-flex ss-col-center"},{default:d((()=>[f(L,{class:"check-box ss-flex ss-col-center ss-p-l-10",onClick:s=>V(e.id)},{default:d((()=>[f(B,{checked:N.selectedIds.includes(e.id),color:"var(--ui-BG-Main)",style:{transform:"scale(0.8)"},onClick:h((s=>V(e.id)),["stop"])},null,8,["checked","onClick"])])),_:2},1032,["onClick"]),f(z,{img:e.spu.picUrl||e.goods.image,price:e.sku.price,skuText:e.sku.properties.length>1?e.sku.properties.reduce(((e,s)=>e.valueName+" "+s.valueName)):e.sku.properties[0].valueName,title:e.spu.name,titleWidth:400,priceColor:"#FF3000"},S({_:2},[N.editMode?void 0:{name:"tool",fn:d((()=>[f(U,{modelValue:e.count,"onUpdate:modelValue":s=>e.count=s,max:e.sku.stock,min:0,step:1,onChange:s=>{return l=e,void(0!==(t=s)?l.goods_num!==t&&(l.goods_num=t,T.update({goods_id:l.id,goods_num:t,goods_sku_price_id:l.goods_sku_price_id})):T.delete(l.id));var t,l}},null,8,["modelValue","onUpdate:modelValue","max","onChange"])])),key:"0"}]),1032,["img","price","skuText","title"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),N.list.length>0?(n(),i(D,{key:0,isInset:!1,val:48,bottom:"",placeholder:""},{default:d((()=>[f(x,{class:"cart-footer ss-flex ss-col-center ss-row-between ss-p-x-30 border-bottom"},{default:d((()=>[f(x,{class:"footer-left ss-flex ss-col-center"},{default:d((()=>[f(L,{class:"check-box ss-flex ss-col-center ss-p-r-30",onClick:E},{default:d((()=>[f(B,{checked:N.isAllSelected,color:"var(--ui-BG-Main)",style:{transform:"scale(0.8)"},onClick:h(E,["stop"])},null,8,["checked"]),f(x,{class:"ss-m-l-8"},{default:d((()=>[p(" 全选")])),_:1})])),_:1}),f(o,null,{default:d((()=>[p("合计：")])),_:1}),f(x,{class:"text-price price-text"},{default:d((()=>[p(m(r(A)(N.totalPriceSelected)),1)])),_:1})])),_:1}),f(x,{class:"footer-right"},{default:d((()=>[N.editMode?(n(),i($,{key:0,class:"ss-reset-button ui-BG-Main-Gradient pay-btn ui-Shadow-Main",onClick:P},{default:d((()=>[p(" 删除 ")])),_:1})):(n(),i($,{key:1,class:"ss-reset-button ui-BG-Main-Gradient pay-btn ui-Shadow-Main",onClick:F},{default:d((()=>{var e;return[p(" 去结算 "+m((null==(e=N.selectedIds)?void 0:e.length)?`(${N.selectedIds.length})`:""),1)]})),_:1}))])),_:1})])),_:1})])),_:1})):u("",!0)])),_:1})):u("",!0)])),_:1})}}},[["__scopeId","data-v-ce430b72"]]);export{L as default};
