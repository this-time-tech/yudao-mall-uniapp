import{_ as e}from"./s-goods-item.B-P-c7gz.js";import{v as s,c as a,r as l,e as o,j as t,f as r,w as d,k as i,p as c,l as n,F as u,m as f,A as p,t as m,i as y,E as v,G as _,S as I,D as b,g as k,y as w,x,u as h,s as P,au as g,ab as C,C as U,q as T,U as V,o as A,av as S,a9 as N,a0 as $,ar as j,as as M}from"./index-BYbmVHYF.js";import{c as O,g as E,_ as B,S as D}from"./s-layout.B9Wf0wyf.js";import{_ as G}from"./s-coupon-list.B9OTvXdB.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{T as L}from"./config.D7xAjhh9.js";import{f as F}from"./useGoods.BAFIflfD.js";import"./index.DEmjmW11.js";const R=H({__name:"s-coupon-select",props:{modelValue:{type:Object,default(){}},show:{type:Boolean,default:!1}},emits:["confirm","close"],setup(e,{emit:k}){const w=e,x=k,h=s({couponInfo:a((()=>w.modelValue)),couponId:void 0});function P(e){h.couponId===e?h.couponId=void 0:h.couponId=e}const g=()=>{x("confirm",h.couponId)};return(s,a)=>{const k=y,w=v,C=_,U=l(o("s-coupon-list"),G),T=I,V=b,A=l(o("su-popup"),O);return t(),r(A,{show:e.show,type:"bottom",round:"20",onClose:a[0]||(a[0]=e=>x("close")),showClose:"",backgroundColor:"#f2f2f2"},{default:d((()=>[i(k,{class:"model-box"},{default:d((()=>[i(k,{class:"title ss-m-t-16 ss-m-l-20 ss-flex"},{default:d((()=>[c("优惠券")])),_:1}),i(T,{class:"model-content","scroll-y":"","scroll-with-animation":!1,"enable-back-to-top":!0},{default:d((()=>[i(k,{class:"subtitle ss-m-l-20"},{default:d((()=>[c("可使用优惠券")])),_:1}),(t(!0),n(u,null,f(h.couponInfo.filter((e=>e.match)),((e,s)=>(t(),r(k,{key:s},{default:d((()=>[i(U,{data:e,type:"user",disabled:!1},{default:d((()=>[i(C,{class:"ss-flex ss-col-center",onClick:s=>P(e.id)},{default:d((()=>[i(w,{color:"var(--ui-BG-Main)",style:{transform:"scale(0.8)"},checked:h.couponId===e.id,onClick:p((s=>P(e.id)),["stop"])},null,8,["checked","onClick"])])),_:2},1032,["onClick"])])),_:2},1032,["data"])])),_:2},1024)))),128)),i(k,{class:"subtitle ss-m-t-40 ss-m-l-20"},{default:d((()=>[c("不可使用优惠券")])),_:1}),(t(!0),n(u,null,f(h.couponInfo.filter((e=>!e.match)),(e=>(t(),r(k,{key:e.id},{default:d((()=>[i(U,{data:e,type:"user",disabled:!0},{reason:d((()=>[i(k,{class:"ss-flex ss-m-t-24"},{default:d((()=>[i(k,{class:"reason-title"},{default:d((()=>[c(" 不可用原因：")])),_:1}),i(k,{class:"reason-desc"},{default:d((()=>[c(m(e.mismatchReason||"未达到使用门槛"),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["data"])])),_:2},1024)))),128))])),_:1})])),_:1}),i(k,{class:"modal-footer ss-flex"},{default:d((()=>[i(V,{class:"confirm-btn ss-reset-button",onClick:g},{default:d((()=>[c("确认")])),_:1})])),_:1})])),_:1},8,["show"])}}},[["__scopeId","data-v-a2598bc0"]]),K=H({__name:"s-discount-list",props:{promoInfo:{type:Array,default:()=>[]},goodsList:{type:Array,default:()=>[]},modelValue:{type:Object,default(){}},show:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:p}){const v=e,_=p,w=s({orderInfo:a((()=>v.modelValue))});return(s,a)=>{const p=y,v=I,x=b,h=l(o("su-popup"),O);return t(),r(h,{show:e.show,type:"bottom",round:"20",onClose:a[1]||(a[1]=e=>_("close")),showClose:"",backgroundColor:"#f2f2f2"},{default:d((()=>[i(p,{class:"model-box"},{default:d((()=>[i(p,{class:"title ss-m-t-38 ss-m-l-20 ss-m-b-40"},{default:d((()=>[c("活动优惠")])),_:1}),i(v,{class:"model-content ss-m-l-20","scroll-y":"","scroll-with-animation":!1,"enable-back-to-top":!0},{default:d((()=>[(t(!0),n(u,null,f(w.orderInfo.promotions,((e,s)=>(t(),r(p,{key:s},{default:d((()=>[[1,2,3,4,5].includes(e.type)?(t(),r(p,{key:0,class:"ss-flex ss-m-b-40 subtitle"},{default:d((()=>[i(p,null,{default:d((()=>[c(m(e.description),1)])),_:2},1024)])),_:2},1024)):k("",!0)])),_:2},1024)))),128))])),_:1})])),_:1}),i(p,{class:"modal-footer ss-flex"},{default:d((()=>[i(x,{class:"confirm-btn ss-reset-button",onClick:a[0]||(a[0]=e=>_("close"))},{default:d((()=>[c("确认")])),_:1})])),_:1})])),_:1},8,["show"])}}},[["__scopeId","data-v-48982bad"]]),q=H({__name:"addressSelection",props:{modelValue:{type:Object,default(){}}},emits:["update:modelValue"],setup(e,{emit:s}){const l=e,o=s,n=a({get:()=>new Proxy(l.modelValue,{set:(e,s,a)=>(o("update:modelValue",{...e,[s]:a}),!0)}),set(e){o("update:modelValue",e)}});function u(){let e="SELECT_ADDRESS",s="/pages/user/address/list?type=select";2===n.value.deliveryType&&(e="SELECT_PICK_UP_INFO",s="/pages/user/goods_details_store/index"),g(e,(e=>{!async function(e={}){C(e)||(1===n.value.deliveryType&&(n.value.addressInfo=e),2===n.value.deliveryType&&(n.value.pickUpInfo=e))}(e.addressInfo)})),P.$router.go(s)}const f=e=>{n.value.deliveryType=e};return(e,s)=>{const a=y,l=U,o=T;return t(),r(a,{class:"allAddress",style:x(n.value.isPickUp?"":"padding-top:10rpx;")},{default:d((()=>[i(a,{class:"nav flex flex-wrap"},{default:d((()=>[n.value.isPickUp?(t(),r(a,{key:0,class:w(["item font-color",1===n.value.deliveryType?"on":"on2"]),onClick:s[0]||(s[0]=e=>f(1))},null,8,["class"])):k("",!0),n.value.isPickUp?(t(),r(a,{key:1,class:w(["item font-color",2===n.value.deliveryType?"on":"on2"]),onClick:s[1]||(s[1]=e=>f(2))},null,8,["class"])):k("",!0)])),_:1}),1===n.value.deliveryType?(t(),r(a,{key:0,class:"address flex flex-wrap flex-center ss-row-between",onClick:u,style:x(n.value.isPickUp?"":"border-top-left-radius: 14rpx;border-top-right-radius: 14rpx;")},{default:d((()=>[n.value.addressInfo.name?(t(),r(a,{key:0,class:"addressCon"},{default:d((()=>[i(a,{class:"name"},{default:d((()=>[c(m(n.value.addressInfo.name)+" ",1),i(l,{class:"phone"},{default:d((()=>[c(m(n.value.addressInfo.mobile),1)])),_:1})])),_:1}),i(a,{class:"flex flex-wrap"},{default:d((()=>[n.value.addressInfo.defaultStatus?(t(),r(l,{key:0,class:"default font-color"},{default:d((()=>[c("[默认]")])),_:1})):k("",!0),i(l,{class:"line2"},{default:d((()=>[c(m(n.value.addressInfo.areaName)+" "+m(n.value.addressInfo.detailAddress),1)])),_:1})])),_:1})])),_:1})):(t(),r(a,{key:1,class:"addressCon"},{default:d((()=>[i(a,{class:"setaddress"},{default:d((()=>[c("设置收货地址")])),_:1})])),_:1})),i(a,{class:"iconfont"},{default:d((()=>[i(a,{class:"ss-rest-button"},{default:d((()=>[i(l,{class:"_icon-forward"})])),_:1})])),_:1})])),_:1},8,["style"])):k("",!0),2===n.value.deliveryType?(t(),r(a,{key:1,class:"address flex flex-wrap flex-center ss-row-between",onClick:u},{default:d((()=>[n.value.pickUpInfo.name?(t(),r(a,{key:0,class:"addressCon"},{default:d((()=>[i(a,{class:"name"},{default:d((()=>[c(m(n.value.pickUpInfo.name)+" ",1),i(l,{class:"phone"},{default:d((()=>[c(m(n.value.pickUpInfo.phone),1)])),_:1})])),_:1}),i(a,{class:"line1"},{default:d((()=>[c(m(n.value.pickUpInfo.areaName)+m(", "+n.value.pickUpInfo.detailAddress),1)])),_:1})])),_:1})):(t(),r(a,{key:1,class:"addressCon"},{default:d((()=>[i(a,{class:"setaddress"},{default:d((()=>[c("选择自提门店")])),_:1})])),_:1})),i(a,{class:"iconfont"},{default:d((()=>[i(a,{class:"ss-rest-button"},{default:d((()=>[i(l,{class:"_icon-forward"})])),_:1})])),_:1})])),_:1})):k("",!0),i(a,{class:"line"},{default:d((()=>[i(o,{src:h(P).$url.static("/static/images/line.png","local")},null,8,["src"])])),_:1})])),_:1},8,["style"])}}},[["__scopeId","data-v-9f2ad794"]]),J=H({__name:"confirm",setup(a){const p=s({orderPayload:{},orderInfo:{items:[],price:{}},showCoupon:!1,couponInfo:[],showDiscount:!1,pointStatus:!1}),v=V({addressInfo:{},deliveryType:void 0,isPickUp:!0,pickUpInfo:{},receiverName:"",receiverMobile:""}),_=async()=>{p.pointStatus=!p.pointStatus,await g()};async function I(e){p.orderPayload.couponId=e,await g(),p.showCoupon=!1}function x(){if(1!==v.value.deliveryType||v.value.addressInfo.id){if(2===v.value.deliveryType){if(!v.value.pickUpInfo.id)return void P.$helper.toast("请选择自提门店地址");if(""===v.value.receiverName||""===v.value.receiverMobile)return void P.$helper.toast("请填写联系人或联系人电话");if(!/^[\u4e00-\u9fa5\w]{2,16}$/.test(v.value.receiverName))return void P.$helper.toast("请填写您的真实姓名");if(!/^1(3|4|5|7|8|9|6)\d{9}$/.test(v.value.receiverMobile))return void P.$helper.toast("请填写正确的手机号")}!async function(){const{code:e,data:s}=await $.createOrder({items:p.orderPayload.items,couponId:p.orderPayload.couponId,remark:p.orderPayload.remark,deliveryType:v.value.deliveryType,addressId:v.value.addressInfo.id,pickUpStoreId:v.value.pickUpInfo.id,receiverName:v.value.receiverName,receiverMobile:v.value.receiverMobile,pointStatus:p.pointStatus,combinationActivityId:p.orderPayload.combinationActivityId,combinationHeadId:p.orderPayload.combinationHeadId,seckillActivityId:p.orderPayload.seckillActivityId,pointActivityId:p.orderPayload.pointActivityId});if(0!==e)return;p.orderPayload.items[0].cartId>0&&P.$store("cart").getList();s.payOrderId&&s.payOrderId>0?P.$router.redirect("/pages/pay/index",{id:s.payOrderId}):P.$router.redirect("/pages/order/detail",{id:s.id})}()}else P.$helper.toast("请选择收货地址")}async function g(){const{data:e,code:s}=await $.settlementOrder({items:p.orderPayload.items,couponId:p.orderPayload.couponId,deliveryType:v.value.deliveryType,addressId:v.value.addressInfo.id,pickUpStoreId:v.value.pickUpInfo.id,receiverName:v.value.receiverName,receiverMobile:v.value.receiverMobile,pointStatus:p.pointStatus,combinationActivityId:p.orderPayload.combinationActivityId,combinationHeadId:p.orderPayload.combinationHeadId,seckillActivityId:p.orderPayload.seckillActivityId,pointActivityId:p.orderPayload.pointActivityId});return 0!==s||(p.orderInfo=e,p.couponInfo=e.coupons||[],p.orderInfo.address&&(v.value.addressInfo=p.orderInfo.address)),s}return A((async e=>{if(!e.data)return void P.$helper.toast("参数不正确，请检查！");p.orderPayload=JSON.parse(e.data);const{data:s,code:a}=await L.getTradeConfig();if(0===a&&(v.value.isPickUp=s.deliveryPickUpEnabled),v.value.deliveryType=S.EXPRESS.type,0!==await g()){if(v.value.isPickUp){if(v.value.deliveryType=S.PICK_UP.type,0===await g())return}v.value.deliveryType=void 0,await g()}})),N(v,(async(e,s)=>{e.addressInfo.id===s.addressInfo.id&&e.deliveryType===s.deliveryType||await g()})),(s,a)=>{const g=l(o("s-goods-item"),e),C=y,V=l(o("uni-easyinput"),E),A=U,S=T,N=j,$=M,O=l(o("s-coupon-select"),R),G=l(o("s-discount-list"),K),H=b,L=l(o("su-fixed"),B),J=l(o("s-layout"),D);return t(),r(J,{title:"确认订单"},{default:d((()=>[i(q,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e)},null,8,["modelValue"]),i(C,{class:"order-card-box ss-m-b-14"},{default:d((()=>[(t(!0),n(u,null,f(p.orderInfo.items,(e=>(t(),r(g,{key:e.skuId,img:e.picUrl,title:e.spuName,skuText:e.properties.map((e=>e.valueName)).join(" "),price:e.price,num:e.count,marginBottom:"10"},null,8,["img","title","skuText","price","num"])))),128)),i(C,{class:"order-item ss-flex ss-col-center ss-row-between ss-p-x-20 bg-white ss-r-10"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("订单备注")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[i(V,{maxlength:"20",placeholder:"建议留言前先与商家沟通",modelValue:p.orderPayload.remark,"onUpdate:modelValue":a[1]||(a[1]=e=>p.orderPayload.remark=e),inputBorder:!1,clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),i(C,{class:"bg-white total-card-box ss-p-20 ss-m-b-14 ss-r-10"},{default:d((()=>[i(C,{class:"total-box-content border-bottom"},{default:d((()=>[i(C,{class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("商品金额")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[i(A,{class:"item-value ss-m-r-24"},{default:d((()=>[c(" ￥"+m(h(F)(p.orderInfo.price.totalPrice)),1)])),_:1})])),_:1})])),_:1}),p.orderPayload.pointActivityId?(t(),r(C,{key:0,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("兑换积分")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[i(S,{src:h(P).$url.static("/static/img/shop/goods/score1.svg"),class:"score-img"},null,8,["src"]),i(A,{class:"item-value ss-m-r-24"},{default:d((()=>[c(m(p.orderInfo.usePoint),1)])),_:1})])),_:1})])),_:1})):k("",!0),0===p.orderInfo.type||p.orderPayload.pointActivityId?(t(),r(C,{key:1,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("积分抵扣")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[c(m(p.pointStatus||p.orderPayload.pointActivityId?"剩余积分":"当前积分")+" ",1),i(S,{src:h(P).$url.static("/static/img/shop/goods/score1.svg"),class:"score-img"},null,8,["src"]),i(A,{class:"item-value ss-m-r-24"},{default:d((()=>[c(m(p.pointStatus||p.orderPayload.pointActivityId?p.orderInfo.totalPoint-p.orderInfo.usePoint:p.orderInfo.totalPoint||0),1)])),_:1}),p.orderPayload.pointActivityId?k("",!0):(t(),r($,{key:0,onChange:_},{default:d((()=>[i(N,{checked:p.pointStatus,disabled:!p.orderInfo.totalPoint||p.orderInfo.totalPoint<=0},null,8,["checked","disabled"])])),_:1}))])),_:1})])),_:1})):k("",!0),1===v.value.deliveryType?(t(),r(C,{key:2,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("运费")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[p.orderInfo.price.deliveryPrice>0?(t(),r(A,{key:0,class:"item-value ss-m-r-24"},{default:d((()=>[c(" +￥"+m(h(F)(p.orderInfo.price.deliveryPrice)),1)])),_:1})):(t(),r(C,{key:1,class:"item-value ss-m-r-24"},{default:d((()=>[c("免运费")])),_:1}))])),_:1})])),_:1})):k("",!0),2===v.value.deliveryType?(t(),r(C,{key:3,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("联系人")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[i(V,{maxlength:"20",placeholder:"请填写您的联系姓名",modelValue:v.value.receiverName,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value.receiverName=e),inputBorder:!1,clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})):k("",!0),2===v.value.deliveryType?(t(),r(C,{key:4,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("联系电话")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[i(V,{maxlength:"20",placeholder:"请填写您的联系电话",modelValue:v.value.receiverMobile,"onUpdate:modelValue":a[3]||(a[3]=e=>v.value.receiverMobile=e),inputBorder:!1,clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})):k("",!0),0===p.orderInfo.type?(t(),r(C,{key:5,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("优惠券")])),_:1}),i(C,{class:"ss-flex ss-col-center",onClick:a[4]||(a[4]=e=>p.showCoupon=!0)},{default:d((()=>[p.orderPayload.couponId>0?(t(),r(A,{key:0,class:"item-value text-red"},{default:d((()=>[c(" -￥"+m(h(F)(p.orderInfo.price.couponPrice)),1)])),_:1})):(t(),r(A,{key:1,class:w(["item-value",p.couponInfo.filter((e=>e.match)).length>0?"text-red":"text-disabled"])},{default:d((()=>[c(m(p.couponInfo.filter((e=>e.match)).length>0?p.couponInfo.filter((e=>e.match)).length+" 张可用":"暂无可用优惠券"),1)])),_:1},8,["class"])),i(A,{class:"_icon-forward item-icon"})])),_:1})])),_:1})):k("",!0),p.orderInfo.price.discountPrice>0?(t(),r(C,{key:6,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("活动优惠")])),_:1}),i(C,{class:"ss-flex ss-col-center",onClick:a[5]||(a[5]=e=>p.showDiscount=!0)},{default:d((()=>[i(A,{class:"item-value text-red"},{default:d((()=>[c(" -￥"+m(h(F)(p.orderInfo.price.discountPrice)),1)])),_:1}),i(A,{class:"_icon-forward item-icon"})])),_:1})])),_:1})):k("",!0),p.orderInfo.price.vipPrice>0?(t(),r(C,{key:7,class:"order-item ss-flex ss-col-center ss-row-between"},{default:d((()=>[i(C,{class:"item-title"},{default:d((()=>[c("会员优惠")])),_:1}),i(C,{class:"ss-flex ss-col-center"},{default:d((()=>[i(A,{class:"item-value text-red"},{default:d((()=>[c(" -￥"+m(h(F)(p.orderInfo.price.vipPrice)),1)])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1}),i(C,{class:"total-box-footer ss-font-28 ss-flex ss-row-right ss-col-center ss-m-r-28"},{default:d((()=>[i(C,{class:"total-num ss-m-r-20"},{default:d((()=>[c(" 共"+m(p.orderInfo.items.reduce(((e,s)=>e+s.count),0))+"件 ",1)])),_:1}),i(C,null,{default:d((()=>[c("合计：")])),_:1}),i(C,{class:"total-num text-red"},{default:d((()=>[c(" ￥"+m(h(F)(p.orderInfo.price.payPrice)),1)])),_:1})])),_:1})])),_:1}),i(O,{modelValue:p.couponInfo,"onUpdate:modelValue":a[6]||(a[6]=e=>p.couponInfo=e),show:p.showCoupon,onConfirm:I,onClose:a[7]||(a[7]=e=>p.showCoupon=!1)},null,8,["modelValue","show"]),i(G,{modelValue:p.orderInfo,"onUpdate:modelValue":a[8]||(a[8]=e=>p.orderInfo=e),show:p.showDiscount,onClose:a[9]||(a[9]=e=>p.showDiscount=!1)},null,8,["modelValue","show"]),i(L,{bottom:"",opacity:!1,bg:"bg-white",placeholder:"",noFixed:!1,index:200},{default:d((()=>[i(C,{class:"footer-box border-top ss-flex ss-row-between ss-p-x-20 ss-col-center"},{default:d((()=>[i(C,{class:"total-box-footer ss-flex ss-col-center"},{default:d((()=>[i(C,{class:"total-num ss-font-30 text-red"},{default:d((()=>[c(" ￥"+m(h(F)(p.orderInfo.price.payPrice)),1)])),_:1})])),_:1}),i(H,{class:"ss-reset-button ui-BG-Main-Gradient ss-r-40 submit-btn ui-Shadow-Main",onClick:x},{default:d((()=>[c(" 提交订单 ")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-d65513fa"]]);export{J as default};
