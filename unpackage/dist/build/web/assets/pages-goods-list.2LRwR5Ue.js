import{_ as t}from"./su-tabs.BDGqlBG6.js";import{s,v as o,o as a,aq as e,r,e as i,f as l,w as n,a0 as d,j as c,k as u,l as p,m as g,F as f,u as m,g as b,i as h,C as y,y as k,p as _,t as S,D as x}from"./index-BYbmVHYF.js";import{_ as w}from"./su-sticky.J63v9NrQ.js";import{c as L,S as C}from"./s-layout.B9Wf0wyf.js";import{_ as F}from"./s-goods-column.BMPRB1aK.js";import{_ as j}from"./uni-load-more.7Sj0orxA.js";import{_ as v}from"./s-empty.tLh6VNZu.js";import{r as G}from"./index.DEmjmW11.js";import{S as O}from"./spu.DkDzSSyF.js";import{a as z}from"./useGoods.BAFIflfD.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{l as T}from"./lodash.default.pbM9n79J.js";import"./min.BPJjMKdV.js";const R=I({__name:"list",emits:["close","change"],setup(I,{emit:R}){const N=s.$platform.navbar,$=o({pagination:{list:[],total:0,pageNo:1,pageSize:6},currentSort:void 0,currentOrder:void 0,currentTab:0,curFilter:0,showFilter:!1,iconStatus:!1,keyword:"",categoryId:0,tabList:[{name:"综合推荐",list:[{label:"综合推荐"},{label:"价格升序",sort:"price",order:!0},{label:"价格降序",sort:"price",order:!1}]},{name:"销量",sort:"salesCount",order:!1},{name:"新品优先",value:"createTime",order:!1}],loadStatus:"",leftGoodsList:[],rightGoodsList:[]});let q=0,H=0,M=0;function P(t=0,s="left"){$.pagination.list[q]&&("left"===s?H+=t:M+=t,H<=M?$.leftGoodsList.push($.pagination.list[q]):$.rightGoodsList.push($.pagination.list[q]),q++)}function W(){G($.pagination),$.leftGoodsList=[],$.rightGoodsList=[],q=0,H=0,M=0}function A(t){$.keyword=t,W(),Z($.currentSort,$.currentOrder)}function D(t){if($.tabList[t.index].list)return $.currentTab=t.index,void($.showFilter=!$.showFilter);$.showFilter=!1,t.index!==$.currentTab&&($.currentTab=t.index,$.currentSort=t.sort,$.currentOrder=t.order,W(),Z(t.sort,t.order))}async function Z(){$.loadStatus="loading";const{code:t,data:s}=await O.getSpuPage({pageNo:$.pagination.pageNo,pageSize:$.pagination.pageSize,sortField:$.currentSort,sortAsc:$.currentOrder,categoryId:$.categoryId,keyword:$.keyword});0===t&&(await d.getSettlementProduct(s.list.map((t=>t.id)).join(",")).then((t=>{0===t.code&&z(s.list,t.data)})),$.pagination.list=T.concat($.pagination.list,s.list),$.pagination.total=s.total,$.loadStatus=$.pagination.list.length<$.pagination.total?"more":"noMore",P())}function B(){"noMore"!==$.loadStatus&&($.pagination.pageNo++,Z($.currentSort,$.currentOrder))}return a((t=>{$.categoryId=t.categoryId,$.keyword=t.keyword,Z($.currentSort,$.currentOrder)})),e((()=>{B()})),(o,a)=>{const e=r(i("su-tabs"),t),d=h,G=y,O=r(i("su-sticky"),w),z=r(i("su-popup"),L),I=r(i("s-goods-column"),F),T=x,R=r(i("uni-load-more"),j),q=r(i("s-empty"),v),H=r(i("s-layout"),C);return c(),l(H,{navbar:"normal",leftWidth:0,rightWidth:0,tools:"search",defaultSearch:$.keyword,onSearch:A},{default:n((()=>[u(O,{bgColor:"#fff"},{default:n((()=>[u(d,{class:"ss-flex"},{default:n((()=>[u(d,{class:"ss-flex-1"},{default:n((()=>[u(e,{list:$.tabList,scrollable:!1,onChange:D,current:$.currentTab},null,8,["list","current"])])),_:1}),u(d,{class:"list-icon",onClick:a[0]||(a[0]=t=>$.iconStatus=!$.iconStatus)},{default:n((()=>[$.iconStatus?(c(),l(G,{key:0,class:"sicon-goods-list"})):(c(),l(G,{key:1,class:"sicon-goods-card"}))])),_:1})])),_:1})])),_:1}),u(z,{show:$.showFilter,type:"top",round:"10",space:m(N)+38,backgroundColor:"#F6F6F6",zIndex:10,onClose:a[1]||(a[1]=t=>$.showFilter=!1)},{default:n((()=>[u(d,{class:"filter-list-box"},{default:n((()=>[(c(!0),p(f,null,g($.tabList[$.currentTab].list,((t,s)=>(c(),l(d,{class:k(["filter-item",[{"filter-item-active":s===$.curFilter}]]),key:t.value,onClick:t=>{return o=s,void($.currentSort!==$.tabList[0].list[o].sort||$.currentOrder!==$.tabList[0].list[o].order?($.showFilter=!1,$.curFilter=o,$.tabList[0].name=$.tabList[0].list[o].label,$.currentSort=$.tabList[0].list[o].sort,$.currentOrder=$.tabList[0].list[o].order,W(),Z()):$.showFilter=!1);var o}},{default:n((()=>[_(S(t.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["show","space"]),$.iconStatus&&$.pagination.total>0?(c(),l(d,{key:0,class:"goods-list ss-m-t-20"},{default:n((()=>[(c(!0),p(f,null,g($.pagination.list,(t=>(c(),l(d,{class:"ss-p-l-20 ss-p-r-20 ss-m-b-20",key:t.id},{default:n((()=>[u(I,{class:"",size:"lg",data:t,topRadius:10,bottomRadius:10,onClick:o=>m(s).$router.go("/pages/goods/index",{id:t.id})},null,8,["data","onClick"])])),_:2},1024)))),128))])),_:1})):b("",!0),!$.iconStatus&&$.pagination.total>0?(c(),l(d,{key:1,class:"ss-flex ss-flex-wrap ss-p-x-20 ss-m-t-20 ss-col-top"},{default:n((()=>[u(d,{class:"goods-list-box"},{default:n((()=>[(c(!0),p(f,null,g($.leftGoodsList,(t=>(c(),l(d,{class:"left-list",key:t.id},{default:n((()=>[u(I,{class:"goods-md-box",size:"md",data:t,topRadius:10,bottomRadius:10,onClick:o=>m(s).$router.go("/pages/goods/index",{id:t.id}),onGetHeight:a[2]||(a[2]=t=>P(t,"left"))},{cart:n((()=>[u(T,{class:"ss-reset-button cart-btn"})])),_:2},1032,["data","onClick"])])),_:2},1024)))),128))])),_:1}),u(d,{class:"goods-list-box"},{default:n((()=>[(c(!0),p(f,null,g($.rightGoodsList,(t=>(c(),l(d,{class:"right-list",key:t.id},{default:n((()=>[u(I,{class:"goods-md-box",size:"md",topRadius:10,bottomRadius:10,data:t,onClick:o=>m(s).$router.go("/pages/goods/index",{id:t.id}),onGetHeight:a[3]||(a[3]=t=>P(t,"right"))},{cart:n((()=>[u(T,{class:"ss-reset-button cart-btn"})])),_:2},1032,["data","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})):b("",!0),$.pagination.total>0?(c(),l(R,{key:2,status:$.loadStatus,"content-text":{contentdown:"上拉加载更多"},onClick:B},null,8,["status"])):b("",!0),0===$.pagination.total?(c(),l(q,{key:3,icon:"/static/soldout-empty.png",text:"暂无商品"})):b("",!0)])),_:1},8,["defaultSearch"])}}},[["__scopeId","data-v-bfa99b09"]]);export{R as default};
