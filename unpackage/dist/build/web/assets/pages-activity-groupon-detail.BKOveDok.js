import{z as a,s as e,v as s,c as t,o,r as d,e as r,f as c,w as l,u as n,j as i,g as u,x as f,k as m,p,t as g,l as h,m as _,F as b,ab as k,ac as y,a7 as w,i as x,C as R,q as v,D as I}from"./index-BYbmVHYF.js";import{_ as S}from"./s-goods-item.B-P-c7gz.js";import{_ as j}from"./s-select-groupon-sku.DEz4dVVO.js";import{_ as C}from"./s-empty.tLh6VNZu.js";import{S as N}from"./s-layout.B9Wf0wyf.js";import{f as A,u as $}from"./useGoods.BAFIflfD.js";import{C as T}from"./combination.xWWPgO_7.js";import{S as P}from"./spu.DkDzSSyF.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./su-number-box.BEEzrRQc.js";import"./index.DEmjmW11.js";const D=z({__name:"detail",setup(z){a((a=>({"408bcc16":n(D)})));const D=e.$url.css("/static/img/shop/user/withdraw_bg.png"),H=2*e.$platform.device.statusBarHeight,E=s({data:{},goodsId:0,goodsInfo:{},showSelectSku:!1,selectedSkuPrice:{},activity:{},grouponId:0,grouponNum:0,grouponAction:"create",combinationHeadId:null,loading:!0}),U=t((()=>{var a;return k(E.data)?{}:e.$platform.share.getShareInfo({title:E.data.headRecord.spuName,image:e.$url.cdn(E.data.headRecord.picUrl),desc:null==(a=E.data.goods)?void 0:a.subtitle,params:{page:y.GROUPON_DETAIL.value,query:E.data.headRecord.id}},{type:"groupon",title:E.data.headRecord.spuName,image:e.$url.cdn(E.data.headRecord.picUrl),price:A(E.data.headRecord.combinationPrice)})}));function B(a){e.$router.go("/pages/order/detail",{id:a})}function M(){E.grouponAction="create",E.grouponId=0,E.showSelectSku=!0}function O(a){E.selectedSkuPrice=a}function q(a){e.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",combinationActivityId:E.activity.id,combinationHeadId:E.combinationHeadId,items:[{skuId:a.id,count:a.count}]})})}const G=t((()=>$(E.data.headRecord.expireTime)));function F(){w()}return o((a=>{!async function(a){const{code:e,data:s}=await T.getCombinationRecordDetail(a);if(0===e){E.data=s;const a=Number(E.data.headRecord.userSize-E.data.headRecord.userCount);E.remainNumber=a>0?a:0;const{data:e}=await T.getCombinationActivity(s.headRecord.activityId);E.activity=e,E.grouponNum=e.userSize;const{data:t}=await P.getSpuDetail(e.spuId);E.goodsId=t.id,e.products.forEach((a=>{t.price=Math.min(t.price,a.combinationPrice)})),E.goodsInfo=t,t.skus.forEach((a=>{const s=e.products.find((e=>e.skuId===a.id));s?a.price=s.combinationPrice:a.stock=0}))}else E.data=null;E.loading=!1}(a.id)})),(a,s)=>{const t=x,o=d(r("s-goods-item"),S),y=R,w=v,A=I,$=d(r("s-select-groupon-sku"),j),T=d(r("s-empty"),C),P=d(r("s-layout"),N);return i(),c(P,{title:"拼团详情",class:"detail-wrap",navbar:E.data&&!E.loading?"inner":"normal",onShareAppMessage:U.value},{default:l((()=>[E.loading?(i(),c(t,{key:0})):u("",!0),E.data&&!E.loading?(i(),c(t,{key:1},{default:l((()=>[E.data.headRecord?(i(),c(t,{key:0,class:"recharge-box",style:f([{marginTop:"-"+Number(H+88)+"rpx",paddingTop:Number(H+108)+"rpx"}])},{default:l((()=>[m(o,{class:"goods-box",img:E.data.headRecord.picUrl,title:E.data.headRecord.spuName,price:E.data.headRecord.combinationPrice,priceColor:"#E1212B",onClick:s[0]||(s[0]=a=>n(e).$router.go("/pages/goods/groupon",{id:E.data.headRecord.activityId})),style:f([{top:Number(H+108)+"rpx"}])},{groupon:l((()=>[m(t,{class:"ss-flex"},{default:l((()=>[m(t,{class:"sales-title"},{default:l((()=>[p(g(E.data.headRecord.userSize)+"人团",1)])),_:1}),m(t,{class:"num-title ss-m-l-20"},{default:l((()=>[p("已拼"+g(E.data.headRecord.userCount)+"件",1)])),_:1})])),_:1})])),_:1},8,["img","title","price","style"])])),_:1},8,["style"])):u("",!0),m(t,{class:"countdown-box detail-card ss-p-t-44 ss-flex-col ss-col-center"},{default:l((()=>[1===E.data.headRecord.status?(i(),c(t,{key:0},{default:l((()=>[E.data.orderId?(i(),c(t,{key:0},{default:l((()=>[m(t,{class:"countdown-title ss-flex"},{default:l((()=>[m(y,{class:"cicon-check-round"}),p(" 恭喜您~拼团成功 ")])),_:1})])),_:1})):(i(),c(t,{key:1},{default:l((()=>[m(t,{class:"countdown-title ss-flex"},{default:l((()=>[m(y,{class:"cicon-info"}),p(" 抱歉~该团已满员 ")])),_:1})])),_:1}))])),_:1})):u("",!0),2===E.data.headRecord.status?(i(),c(t,{key:1},{default:l((()=>[m(t,{class:"countdown-title ss-flex"},{default:l((()=>[m(y,{class:"cicon-info"}),p(" "+g(E.data.orderId?"拼团超时,已自动退款":"该团已解散"),1)])),_:1})])),_:1})):u("",!0),0===E.data.headRecord.status?(i(),c(t,{key:2},{default:l((()=>[E.data.headRecord.expireTime<=(new Date).getTime()?(i(),c(t,{key:0},{default:l((()=>[m(t,{class:"countdown-title ss-flex"},{default:l((()=>[m(y,{class:"cicon-info"}),p(" 拼团已结束,请关注下次活动 ")])),_:1})])),_:1})):(i(),c(t,{key:1,class:"countdown-title ss-flex"},{default:l((()=>[p(" 还差 "),m(t,{class:"num"},{default:l((()=>[p(g(E.data.headRecord.userSize-E.data.headRecord.userCount)+"人",1)])),_:1}),p(" 拼团成功 "),m(t,{class:"ss-flex countdown-time"},{default:l((()=>[m(t,{class:"countdown-h ss-flex ss-row-center"},{default:l((()=>[p(g(G.value.h),1)])),_:1}),m(t,{class:"ss-m-x-4"},{default:l((()=>[p(":")])),_:1}),m(t,{class:"countdown-num ss-flex ss-row-center"},{default:l((()=>[p(g(G.value.m),1)])),_:1}),m(t,{class:"ss-m-x-4"},{default:l((()=>[p(":")])),_:1}),m(t,{class:"countdown-num ss-flex ss-row-center"},{default:l((()=>[p(g(G.value.s),1)])),_:1})])),_:1})])),_:1}))])),_:1})):u("",!0),m(t,{class:"ss-m-t-60 ss-flex ss-flex-wrap ss-row-center"},{default:l((()=>[m(t,{class:"header-avatar ss-m-r-24 ss-m-b-20"},{default:l((()=>[m(w,{src:n(e).$url.cdn(E.data.headRecord.avatar),class:"avatar-img"},null,8,["src"]),m(t,{class:"header-tag ss-flex ss-col-center ss-row-center"},{default:l((()=>[p("团长")])),_:1})])),_:1}),(i(!0),h(b,null,_(E.data.memberRecords,(a=>(i(),c(t,{class:"header-avatar ss-m-r-24 ss-m-b-20",key:a.id},{default:l((()=>[m(w,{src:n(e).$url.cdn(a.avatar),class:"avatar-img"},null,8,["src"]),"1"==a.is_leader?(i(),c(t,{key:0,class:"header-tag ss-flex ss-col-center ss-row-center"},{default:l((()=>[p(" 团长 ")])),_:1})):u("",!0)])),_:2},1024)))),128)),(i(!0),h(b,null,_(E.remainNumber,(a=>(i(),c(t,{class:"default-avatar ss-m-r-24 ss-m-b-20",key:a},{default:l((()=>[m(w,{src:n(e).$url.static("/static/img/shop/avatar/unknown.png"),class:"avatar-img"},null,8,["src"])])),_:2},1024)))),128))])),_:1})])),_:1}),1===E.data.headRecord.status||2===E.data.headRecord.status?(i(),c(t,{key:1,class:"ss-m-t-40 ss-flex ss-row-center"},{default:l((()=>[E.data.orderId?(i(),c(A,{key:0,class:"ss-reset-button order-btn",onClick:s[1]||(s[1]=a=>B(E.data.orderId))},{default:l((()=>[p(" 查看订单 ")])),_:1})):(i(),c(A,{key:1,class:"ss-reset-button join-btn",onClick:M},{default:l((()=>[p(" 我要开团 ")])),_:1}))])),_:1})):u("",!0),0===E.data.headRecord.status?(i(),c(t,{key:2,class:"ss-m-t-40 ss-flex ss-row-center"},{default:l((()=>[E.data.headRecord.expireTime<=(new Date).getTime()?(i(),c(t,{key:0},{default:l((()=>[E.data.orderId?(i(),c(A,{key:0,class:"ss-reset-button join-btn",onClick:s[2]||(s[2]=a=>B(E.data.orderId))},{default:l((()=>[p(" 查看订单 ")])),_:1})):(i(),c(A,{key:1,class:"ss-reset-button disabled-btn",disabled:"",onClick:s[3]||(s[3]=a=>B(E.data.orderId))},{default:l((()=>[p(" 去参团 ")])),_:1}))])),_:1})):(i(),c(t,{key:1,class:"ss-flex ss-row-center"},{default:l((()=>[E.data.orderId?(i(),c(t,{key:0},{default:l((()=>[m(A,{class:"ss-reset-button join-btn",disabled:G.value.ms<=0,onClick:F},{default:l((()=>[p(" 邀请好友来拼团 ")])),_:1},8,["disabled"])])),_:1})):(i(),c(t,{key:1},{default:l((()=>[m(A,{class:"ss-reset-button join-btn",disabled:G.value.ms<=0,onClick:s[4]||(s[4]=a=>(E.grouponAction="join",E.grouponId=E.data.headRecord.activityId,E.combinationHeadId=E.data.headRecord.id,E.grouponNum=E.data.headRecord.userSize,void(E.showSelectSku=!0)))},{default:l((()=>[p(" 立即参团 ")])),_:1},8,["disabled"])])),_:1}))])),_:1}))])),_:1})):u("",!0),n(k)(E.goodsInfo)?u("",!0):(i(),c(t,{key:3},{default:l((()=>[m($,{show:E.showSelectSku,goodsInfo:E.goodsInfo,grouponAction:E.grouponAction,grouponNum:E.grouponNum,onBuy:q,onChange:O,onClose:s[5]||(s[5]=a=>E.showSelectSku=!1)},null,8,["show","goodsInfo","grouponAction","grouponNum"])])),_:1}))])),_:1})):u("",!0),E.data||E.loading?u("",!0):(i(),c(T,{key:2,icon:"/static/goods-empty.png"}))])),_:1},8,["navbar","onShareAppMessage"])}}},[["__scopeId","data-v-9258f5ad"]]);export{D as default};
