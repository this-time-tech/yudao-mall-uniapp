import{v as a,o as e,aq as o,r as t,e as i,f as s,w as r,cG as n,j as l,l as c,m as p,F as g,g as m,k as d,u,s as f,p as k,t as _,A as P,$ as b,a7 as y,i as M,D as S}from"./index-BYbmVHYF.js";import{_ as h}from"./s-goods-item.B-P-c7gz.js";import{_ as j}from"./s-empty.tLh6VNZu.js";import{_ as x}from"./uni-load-more.7Sj0orxA.js";import{S as w}from"./s-layout.B9Wf0wyf.js";import{S as v}from"./spu.DkDzSSyF.js";import{f as C}from"./useGoods.BAFIflfD.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{l as $}from"./lodash.default.pbM9n79J.js";import"./index.DEmjmW11.js";import"./min.BPJjMKdV.js";const z=I({__name:"goods",setup(I){const z=a({pagination:{list:[],total:0,pageNo:1,pageSize:8},loadStatus:"",shareInfo:{}});async function G(){z.loadStatus="loading";let{code:a,data:e}=await v.getSpuPage({pageSize:z.pagination.pageSize,pageNo:z.pagination.pageNo});0===a?(await Promise.all(e.list.map((async a=>{try{const e=await n.getProductBrokeragePrice(a.id);a.brokerageMinPrice=e.data.brokerageMinPrice,a.brokerageMaxPrice=e.data.brokerageMaxPrice}catch(e){console.error(`获取商品【${a.name}】的佣金时出错：`,e)}}))),z.pagination.list=$.concat(z.pagination.list,e.list),z.pagination.total=e.total,z.loadStatus=z.pagination.list.length<z.pagination.total?"more":"noMore"):z.loadStatus="error"}function N(){"noMore"!==z.loadStatus&&(z.pagination.pageNo++,G())}return e((()=>{G()})),o((()=>{N()})),(a,e)=>{const o=M,n=S,v=t(i("s-goods-item"),h),I=t(i("s-empty"),j),$=t(i("uni-load-more"),x),G=t(i("s-layout"),w);return l(),s(G,{title:"推广商品",onShareAppMessage:z.shareInfo},{default:r((()=>[(l(!0),c(g,null,p(z.pagination.list,(a=>(l(),s(o,{class:"goods-item ss-m-20",key:a.id},{default:r((()=>[d(v,{size:"lg",img:a.picUrl,title:a.name,subTitle:a.introduction,price:a.price,originPrice:a.marketPrice,priceColor:"#333",onClick:e=>u(f).$router.go("/pages/goods/index",{id:a.id})},{rightBottom:r((()=>[d(o,{class:"ss-flex ss-row-between"},{default:r((()=>[void 0===a.brokerageMinPrice?(l(),s(o,{key:0,class:"commission-num"},{default:r((()=>[k("预计佣金：计算中")])),_:1})):a.brokerageMinPrice===a.brokerageMaxPrice?(l(),s(o,{key:1,class:"commission-num"},{default:r((()=>[k(" 预计佣金："+_(u(C)(a.brokerageMinPrice)),1)])),_:2},1024)):(l(),s(o,{key:2,class:"commission-num"},{default:r((()=>[k(" 预计佣金："+_(u(C)(a.brokerageMinPrice))+" ~ "+_(u(C)(a.brokerageMaxPrice)),1)])),_:2},1024)),d(n,{class:"ss-reset-button share-btn ui-BG-Main-Gradient",onClick:P((e=>{return o=a,z.shareInfo=b.getShareInfo({title:o.name,image:f.$url.cdn(o.picUrl),desc:o.introduction,params:{page:"2",query:o.id}},{type:"goods",title:o.name,image:f.$url.cdn(o.picUrl),price:C(o.price),original_price:C(o.marketPrice)}),void y();var o}),["stop"])},{default:r((()=>[k(" 分享赚 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["img","title","subTitle","price","originPrice","onClick"])])),_:2},1024)))),128)),0===z.pagination.total?(l(),s(I,{key:0,icon:"/static/goods-empty.png",text:"暂无推广商品"})):m("",!0),z.pagination.total>0?(l(),s($,{key:1,status:z.loadStatus,"content-text":{contentdown:"上拉加载更多"},onClick:N},null,8,["status"])):m("",!0)])),_:1},8,["onShareAppMessage"])}}},[["__scopeId","data-v-8a08a031"]]);export{z as default};
