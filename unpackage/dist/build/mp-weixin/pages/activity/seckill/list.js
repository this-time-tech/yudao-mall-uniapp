"use strict";const e=require("../../../common/vendor.js"),t=require("../../../sheep/index.js"),s=require("../../../sheep/hooks/useGoods.js"),a=require("../../../sheep/api/promotion/seckill.js"),u=require("../../../sheep/util/const.js");if(!Array){(e.resolveComponent("su-progress")+e.resolveComponent("s-goods-column")+e.resolveComponent("uni-load-more")+e.resolveComponent("s-layout"))()}Math||((()=>"../../../sheep/ui/su-progress/su-progress.js")+(()=>"../../../sheep/components/s-goods-column/s-goods-column.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../sheep/components/s-layout/s-layout.js"))();const o={__name:"list",setup(o){e.useCssVars((t=>({"0f98a0f2":e.unref(c)})));const{safeAreaInsets:l,safeArea:n}=t.sheep.$platform.device,i=2*t.sheep.$platform.device.statusBarHeight,r=2*(n.height+l.bottom)+i-t.sheep.$platform.navbar-350,c=t.sheep.$url.css("/static/img/shop/goods/seckill-header.png"),v={name:{show:!0},introduction:{show:!0},price:{show:!0},marketPrice:{show:!0}},d=e.ref([]),m=e.ref(""),p=t=>{e.nextTick$1((()=>m.value=`timeItem${t}`))},f=e.ref(0),T=e.computed((()=>d.value[f.value])),g=(e,t)=>{f.value=e,S.pageNo=1,S.configId=t,k.value=[],j()},h=e.computed((()=>{var t;const a=null==(t=T.value)?void 0:t.endTime;if(a)return s.useDurationTime(`${e.dayjs().format("YYYY-MM-DD")} ${a}`)})),S=e.reactive({configId:0,pageNo:1,pageSize:5}),E=e.ref(0),k=e.ref([]),A=e.ref("");async function j(){A.value="loading";const{data:e}=await a.SeckillApi.getSeckillActivityPage(S);e.list.forEach((e=>{e.percent=parseInt(100*(e.totalStock-e.stock)/e.totalStock)})),k.value=k.value.concat(...e.list),E.value=e.total,A.value=k.value.length<E.value?"more":"noMore"}function D(){"noMore"!==A.value&&(S.pageNo+=1,j())}return e.onReachBottom((()=>D())),e.onLoad((async()=>{await(async()=>{const{data:t}=await a.SeckillApi.getSeckillConfigList(),s=e.dayjs(),o=s.format("YYYY-MM-DD"),l=e.ref([]);t.forEach(((t,a)=>{const n=e.dayjs(`${o} ${t.startTime}`),i=e.dayjs(`${o} ${t.endTime}`);l.value[a]=t.id,s.isBefore(n)?t.status=u.TimeStatusEnum.WAIT_START:s.isAfter(i)?t.status=u.TimeStatusEnum.END:(t.status=u.TimeStatusEnum.STARTED,f.value=a)})),d.value=t,g(f.value,l.value[f.value]),p(f.value)})()})),(s,a)=>{var o,l,n,c,p,S,j,$,b;return e.e({a:e.s({marginTop:"-"+Number(i+88)+"rpx"}),b:(null==(l=null==(o=T.value)?void 0:o.sliderPicUrls)?void 0:l.length)>0},(null==(c=null==(n=T.value)?void 0:n.sliderPicUrls)?void 0:c.length)>0?{c:e.f(T.value.sliderPicUrls,((e,t,s)=>({a:e,b:t})))}:{},{d:e.f(d.value,((t,s,a)=>({a:e.t(t.startTime),b:e.t(null==t?void 0:t.status),c:s,d:e.n({active:f.value===s}),e:`timeItem${s}`,f:e.o((e=>g(s,t.id)),s)}))),e:m.value,f:(null==(p=T.value)?void 0:p.status)===e.unref(u.TimeStatusEnum).STARTED},(null==(S=T.value)?void 0:S.status)===e.unref(u.TimeStatusEnum).STARTED?{g:e.t(h.value.h),h:e.t(h.value.m),i:e.t(h.value.s)}:{j:e.t(null==(j=T.value)?void 0:j.status)},{k:e.f(k.value,((s,a,o)=>{var l,n,i,r,c;return e.e({a:e.t(s.stock),b:e.t(s.unitName),c:"9499e2ac-2-"+o+",9499e2ac-1-"+o,d:e.p({percentage:s.percent,strokeWidth:"10",textInside:!0,isAnimate:!0})},(null==(l=T.value)?void 0:l.status)===e.unref(u.TimeStatusEnum).WAIT_START?{e:e.n({disabled:(null==(n=T.value)?void 0:n.status)===e.unref(u.TimeStatusEnum).END})}:(null==(i=T.value)?void 0:i.status)===e.unref(u.TimeStatusEnum).STARTED?{f:e.n({disabled:(null==(r=T.value)?void 0:r.status)===e.unref(u.TimeStatusEnum).END}),g:e.o((a=>e.unref(t.sheep).$router.go("/pages/goods/seckill",{id:s.id})),s.id)}:{h:e.n({disabled:(null==(c=T.value)?void 0:c.status)===e.unref(u.TimeStatusEnum).END})},{i:"9499e2ac-1-"+o+",9499e2ac-0",j:e.p({size:"lg",data:{...s,price:s.seckillPrice},goodsFields:v,seckillTag:!0}),k:s.id})})),l:(null==($=T.value)?void 0:$.status)===e.unref(u.TimeStatusEnum).WAIT_START,m:(null==(b=T.value)?void 0:b.status)===e.unref(u.TimeStatusEnum).STARTED,n:E.value>0},E.value>0?{o:e.o(D),p:e.p({status:A.value,"content-text":{contentdown:"上拉加载更多"}})}:{},{q:r+"rpx",r:e.s(s.__cssVars()),s:e.p({bgStyle:{color:"rgb(245,28,19)"},navbar:"inner"})})}}},l=e._export_sfc(o,[["__scopeId","data-v-9499e2ac"]]);wx.createPage(l);
