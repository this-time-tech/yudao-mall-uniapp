"use strict";const e=require("../../../common/vendor.js"),a=require("../../../sheep/api/promotion/kefu.js"),t=require("../../../sheep/helper/utils.js"),o=require("../../../sheep/index.js"),s=require("../../../sheep/util/index.js");if(!Array){e.resolveComponent("z-paging")()}Math||(i+(()=>"../../../uni_modules/z-paging/components/z-paging/z-paging.js"))();const i=()=>"./messageListItem.js",r={__name:"messageList",setup(i,{expose:r}){const l=o.sheep.$platform.navbar,n=e.ref([]),u=e.ref(!1),c=e.ref(!1),p=e.reactive({width:"100px","background-color":"#fff","border-radius":"30px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)",display:"flex",justifyContent:"center",alignItems:"center"}),m=e.reactive({no:1,limit:20,createTime:void 0}),d=e.ref(null),f=async(e,a)=>{m.no=e,m.limit=a,await g()},g=async()=>{const{data:e}=await a.KeFuApi.getKefuMessageList(m);if(t.isEmpty(e))d.value.completeByNoMore([],!0);else{if(m.no>1&&c.value){const a=[];for(const t of e)n.value.some((e=>e.id===t.id))||a.push(t);return n.value=[...a,...n.value],d.value.updateCache(),void(c.value=!1)}e.slice(-1).length>0&&(m.createTime=s.formatDate(e.slice(-1)[0].createTime)),d.value.completeByNoMore(e,!1)}},v=e=>{e(!1),d.value.scrollToBottom()},h=()=>{1!==m.no&&(u.value=!1)};return r({getMessageList:g,refreshMessageList:async e=>{void 0!==e?d.value.addChatRecordData([e],!1):(m.createTime=void 0,c.value=!0,await g()),m.no>1?u.value=!0:h()}}),(a,t)=>({a:e.unref(l)+"px",b:e.w((({item:a,index:t},o,s)=>({a:"a2f6952e-1-"+s+",a2f6952e-0",b:e.p({message:a,"message-index":t,"message-list":n.value}),c:s,d:o})),{name:"cell",path:"b",vueId:"a2f6952e-0"}),c:e.sr(d,"a2f6952e-0",{k:"pagingRef"}),d:e.o(v),e:e.o(h),f:e.o(f),g:e.o((e=>n.value=e)),h:e.p({"use-chat-record-mode":!0,"use-virtual-list":!0,"cell-height-mode":"dynamic","default-page-size":"20","auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,"bottom-bg-color":"#f8f8f8","back-to-top-style":p,"auto-show-back-to-top":u.value,modelValue:n.value})})}};wx.createComponent(r);
