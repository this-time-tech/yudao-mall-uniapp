"use strict";const e=require("../../common/vendor.js"),t=require("../../sheep/hooks/useGoods.js"),n=require("../../sheep/index.js"),o=require("../../sheep/api/trade/order.js"),a=require("../../sheep/util/index.js");if(!Array){(e.resolveComponent("su-tabs")+e.resolveComponent("su-sticky")+e.resolveComponent("s-empty")+e.resolveComponent("s-goods-item")+e.resolveComponent("uni-load-more")+e.resolveComponent("s-layout"))()}Math||((()=>"../../sheep/ui/su-tabs/su-tabs.js")+(()=>"../../sheep/ui/su-sticky/su-sticky.js")+(()=>"../../sheep/components/s-empty/s-empty.js")+(()=>"../../sheep/components/s-goods-item/s-goods-item.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../sheep/components/s-layout/s-layout.js"))();const i={__name:"list",setup(i){const s=e.reactive({currentTab:0,pagination:{list:[],total:0,pageNo:1,pageSize:5},loadStatus:""}),r=[{name:"全部"},{name:"待付款",value:0},{name:"待发货",value:10},{name:"待收货",value:20},{name:"待评价",value:30}];function u(e){s.currentTab!==e.index&&(a.resetPagination(s.pagination),s.currentTab=e.index,l())}function c(e){n.sheep.$router.go("/pages/order/detail",{id:e})}async function d(t,i=!1){"WechatMiniProgram"!==n.sheep.$platform.name||e.isEmpty(t.wechat_extra_data)||i?e.index.showModal({title:"提示",content:"确认收货吗？",success:async function(e){if(!e.confirm)return;const{code:n}=await o.OrderApi.receiveOrder(t.id);0===n&&(a.resetPagination(s.pagination),await l())}}):function(t){if(!e.wx$1.openBusinessView)return void n.sheep.$helper.toast("请升级微信版本");e.wx$1.openBusinessView({businessType:"weappOrderConfirm",extraData:{merchant_id:"1481069012",merchant_trade_no:t.wechat_extra_data.merchant_trade_no,transaction_id:t.wechat_extra_data.transaction_id},success(e){console.log("success:",e),"openBusinessView:ok"===e.errMsg&&"success"===e.extraData.status&&d(t,!0)},fail(e){console.log("error:",e)},complete(e){console.log("result:",e)}})}(t)}async function l(){s.loadStatus="loading";let{code:n,data:a}=await o.OrderApi.getOrderPage({pageNo:s.pagination.pageNo,pageSize:s.pagination.pageSize,status:r[s.currentTab].value,commentStatus:30!==r[s.currentTab].value&&null});0===n&&(a.list.forEach((e=>t.handleOrderButtons(e))),s.pagination.list=e.lodash.concat(s.pagination.list,a.list),s.pagination.total=a.total,s.loadStatus=s.pagination.list.length<s.pagination.total?"more":"noMore")}function p(){"noMore"!==s.loadStatus&&(s.pagination.pageNo++,l())}return e.onLoad((async e=>{e.type&&(s.currentTab=e.type),await l()})),e.onReachBottom((()=>{p()})),e.onPullDownRefresh((()=>{a.resetPagination(s.pagination),l(),setTimeout((function(){e.index.stopPullDownRefresh()}),800)})),(a,i)=>e.e({a:e.o(u),b:e.p({list:r,scrollable:!1,current:s.currentTab}),c:e.p({bgColor:"#fff"}),d:0===s.pagination.total},0===s.pagination.total?{e:e.p({icon:"/static/order-empty.png",text:"暂无订单"})}:{},{f:s.pagination.total>0},s.pagination.total>0?{g:e.f(s.pagination.list,((a,i,r)=>e.e({a:e.t(a.no),b:e.t(e.unref(t.formatOrderStatus)(a)),c:e.n(e.unref(t.formatOrderColor)(a)),d:e.f(a.items,((t,n,o)=>({a:"44a760e7-4-"+r+"-"+o+",44a760e7-0",b:e.p({img:t.picUrl,title:t.spuName,skuText:t.properties.map((e=>e.valueName)).join(" "),price:t.price,num:t.count}),c:t.id}))),e:e.t(a.productCount),f:e.t(e.unref(t.fen2yuan)(a.payPrice)),g:a.buttons.includes("combination")},a.buttons.includes("combination")?{h:e.o((e=>function(e){n.sheep.$router.go("/pages/activity/groupon/detail",{id:e.combinationRecordId})}(a)),a.id)}:{},{i:0===a.buttons.length},0===a.buttons.length?{j:e.o((e=>c(a.id)),a.id)}:{},{k:a.buttons.includes("confirm")},a.buttons.includes("confirm")?{l:e.o((e=>d(a)),a.id)}:{},{m:a.buttons.includes("express")},a.buttons.includes("express")?{n:e.o((e=>async function(e){n.sheep.$router.go("/pages/order/express/log",{id:e})}(a.id)),a.id)}:{},{o:a.buttons.includes("cancel")},a.buttons.includes("cancel")?{p:e.o((n=>async function(n){e.index.showModal({title:"提示",content:"确定要取消订单吗?",success:async function(e){if(!e.confirm)return;const{code:a}=await o.OrderApi.cancelOrder(n);if(0===a){let e=s.pagination.list.findIndex((e=>e.id===n));const o=s.pagination.list[e];o.status=40,t.handleOrderButtons(o)}}})}(a.id)),a.id)}:{},{q:a.buttons.includes("comment")},a.buttons.includes("comment")?{r:e.o((e=>{return t=a.id,void n.sheep.$router.go("/pages/goods/comment/add",{id:t});var t}),a.id)}:{},{s:a.buttons.includes("delete")},a.buttons.includes("delete")?{t:e.o((t=>{return n=a.id,void e.index.showModal({title:"提示",content:"确定要删除订单吗?",success:async function(e){if(e.confirm){const{code:e}=await o.OrderApi.deleteOrder(n);if(0===e){let e=s.pagination.list.findIndex((e=>e.id===n));s.pagination.list.splice(e,1)}}}});var n}),a.id)}:{},{v:a.buttons.includes("pay")},a.buttons.includes("pay")?{w:e.o((e=>{return t=a.payOrderId,void n.sheep.$router.go("/pages/pay/index",{id:t});var t}),a.id)}:{},{x:e.n(a.buttons.length>3?"ss-row-between":"ss-row-right"),y:a.id,z:e.o((e=>c(a.id)),a.id)})))}:{},{h:s.pagination.total>0},s.pagination.total>0?{i:e.o(p),j:e.p({status:s.loadStatus,"content-text":{contentdown:"上拉加载更多"}})}:{},{k:e.p({title:"我的订单"})})}},s=e._export_sfc(i,[["__scopeId","data-v-44a760e7"]]);wx.createPage(s);
