"use strict";const e=require("../../../common/vendor.js"),t=require("../../index.js"),o=require("../../hooks/useGoods.js");if(!Array){(e.resolveComponent("su-number-box")+e.resolveComponent("su-popup"))()}Math||((()=>"../../ui/su-number-box/su-number-box.js")+(()=>"../../ui/su-popup/su-popup.js"))();const r={__name:"s-select-groupon-sku",props:{show:{type:Boolean,default:!1},goodsInfo:{type:Object,default(){}},grouponAction:{type:String,default:"create"},grouponNum:{type:[Number,String],default:0}},emits:["change","addCart","buy","close","ladder"],setup(r,{emit:u}){e.useCssVars((t=>({"570ab2f0":e.unref(n)})));const n=t.sheep.$url.css("/static/img/shop/goods/groupon-btn-long.png"),s=u,c=r,d=e.reactive({selectedSku:{},currentPropertyArray:[],grouponNum:c.grouponNum}),a=o.convertProductPropertyList(c.goodsInfo.skus),i=e.computed((()=>{let e=c.goodsInfo.skus;for(let t of e)t.value_id_array=t.properties.map((e=>e.valueId));return e}));function l(){!d.selectedSku.id||d.selectedSku.id<=0?t.sheep.$helper.toast("请选择规格"):d.selectedSku.stock<=0?t.sheep.$helper.toast("库存不足"):s("buy",d.selectedSku)}function p(e=!1,t=0,o=0){let r=[];if(e)for(let s of i.value)s.stock<=0||s.value_id_array.indexOf(o)>=0&&r.push(s);else r=f();let u=[];for(let s of r)u=u.concat(s.value_id_array);if(u=Array.from(new Set(u)),e){let e=u.indexOf(o);u.splice(e,1)}else d.currentPropertyArray.forEach((e=>{if(""!==e.toString())return;let t=u.indexOf(e);t>=0&&u.splice(t,1)}));let n=[];e?n=[t]:d.currentPropertyArray.forEach(((e,t)=>{""!==e&&n.push(t)}));for(let s in a)if(!(n.indexOf(a[s].id)>=0))for(let e in a[s].values)a[s].values[e].disabled=u.indexOf(a[s].values[e].id)<0}function f(){let e=[];for(let t of i.value){if(t.stock<=0)continue;let o=!0;d.currentPropertyArray.forEach((e=>{""!==e.toString()&&t.value_id_array.indexOf(e)<0&&(o=!1)})),o&&e.push(t)}return e}return e.watch((()=>d.selectedSku),(e=>{s("change",e)}),{immediate:!0,deep:!0}),p(!1),(u,n)=>e.e({a:e.unref(t.sheep).$url.cdn(d.selectedSku.picUrl||r.goodsInfo.picUrl),b:e.unref(t.sheep).$url.static("/static/img/shop/goods/groupon-tag-white.png"),c:e.t(r.goodsInfo.name),d:e.t(e.unref(o.fen2yuan)(d.selectedSku.price||r.goodsInfo.price||d.selectedSku.marketPrice)),e:e.t(d.selectedSku.stock||r.goodsInfo.stock),f:e.f(e.unref(a),((t,o,r)=>({a:e.t(t.name),b:e.f(t.values,((o,r,u)=>({a:e.t(o.name),b:e.n({"checked-btn":d.currentPropertyArray[t.id]===o.id}),c:e.n({"disabled-btn":!0===o.disabled}),d:o.id,e:!0===o.disabled,f:e.o((e=>function(e,t){let o=!0;void 0!==d.currentPropertyArray[e]&&d.currentPropertyArray[e]===t?(o=!1,d.currentPropertyArray.splice(e,1,"")):d.currentPropertyArray[e]=t;let r=[];d.currentPropertyArray.forEach((e=>{""!==e&&r.push(e)}));let u=f();r.length===a.length&&u.length?(u[0].count=d.selectedSku.count||1,d.selectedSku=u[0]):d.selectedSku={},p(o,e,t)}(t.id,o.id)),o.id)}))),c:t.id}))),g:e.o((e=>{var t;0!==(t=e)&&d.selectedSku.count!==t&&(d.selectedSku.count=t)})),h:e.o((e=>d.selectedSku.count=e)),i:e.p({min:1,max:d.selectedSku.stock,step:1,activity:"groupon",modelValue:d.selectedSku.count}),j:e.t(r.grouponNum+"人团"),k:e.t(e.unref(o.fen2yuan)(d.selectedSku.price*d.selectedSku.count||r.goodsInfo.price*d.selectedSku.count||d.selectedSku.marketPrice*d.selectedSku.count||r.goodsInfo.price)),l:"create"===r.grouponAction},("create"===r.grouponAction||r.grouponAction,{}),{m:"join"===r.grouponAction,n:e.o(l),o:e.o((e=>s("close"))),p:e.s(u.__cssVars()),q:e.p({show:r.show,round:"10"})})}},u=e._export_sfc(r,[["__scopeId","data-v-2a4b5932"]]);wx.createComponent(u);
