"use strict";const e=require("../../../common/vendor.js"),t=require("../../index.js"),r=require("../../hooks/useGoods.js"),o=require("../../util/const.js");if(!Array){(e.resolveComponent("su-number-box")+e.resolveComponent("su-popup"))()}Math||((()=>"../../ui/su-number-box/su-number-box.js")+(()=>"../../ui/su-popup/su-popup.js"))();const s={__name:"s-select-seckill-sku",props:{modelValue:{type:Object,default(){}},show:{type:Boolean,default:!1},singleLimitCount:{type:Number,default:1}},emits:["change","addCart","buy","close"],setup(s,{emit:u}){const n=u,c=s,i=e.reactive({goodsInfo:e.computed((()=>c.modelValue)),selectedSku:{},currentPropertyArray:[]}),l=e.computed((()=>{let t=`￥${r.fen2yuan(i.goodsInfo.price)}`;if(!e.isEmpty(i.selectedSku)){const e=i.selectedSku;t=`${e.point}${e.pointPrice?`+￥${r.fen2yuan(e.pointPrice)}`:""}`}return t})),d=r.convertProductPropertyList(i.goodsInfo.skus),a=e.computed((()=>{let e=i.goodsInfo.skus;for(let t of e)t.value_id_array=t.properties.map((e=>e.valueId));return e}));e.watch((()=>i.selectedSku),(e=>{n("change",e)}),{immediate:!0,deep:!0});const p=()=>{i.selectedSku.id?i.selectedSku.stock<=0?t.sheep.$helper.toast("库存不足"):n("buy",i.selectedSku):t.sheep.$helper.toast("请选择规格")};const f=(e=!1,t=0,r=0)=>{let o=[];if(e)for(let n of a.value)n.stock<=0||n.value_id_array.indexOf(r)>=0&&o.push(n);else o=y();let s=[];for(let n of o)s=s.concat(n.value_id_array);if(s=Array.from(new Set(s)),e){let e=s.indexOf(r);s.splice(e,1)}else i.currentPropertyArray.forEach((e=>{if(""!==e.toString())return;let t=s.indexOf(e);t>=0&&s.splice(t,1)}));let u=[];e?u=[t]:i.currentPropertyArray.forEach(((e,t)=>{""!==e&&u.push(t)}));for(let n in d)if(!(u.indexOf(d[n].id)>=0))for(let e in d[n].values)d[n].values[e].disabled=s.indexOf(d[n].values[e].id)<0},y=()=>{let e=[];for(let t of a.value){if(t.stock<=0)continue;let r=!0;i.currentPropertyArray.forEach((e=>{""!==e.toString()&&t.value_id_array.indexOf(e)<0&&(r=!1)})),r&&e.push(t)}return e};return f(!1),(u,c)=>e.e({a:e.unref(t.sheep).$url.cdn(i.selectedSku.picUrl||i.goodsInfo.picUrl),b:e.t(i.goodsInfo.name),c:i.goodsInfo.activity_type===e.unref(o.PromotionActivityTypeEnum).POINT.type},i.goodsInfo.activity_type===e.unref(o.PromotionActivityTypeEnum).POINT.type?e.e({d:!e.unref(e.isEmpty)(i.selectedSku)},e.unref(e.isEmpty)(i.selectedSku)?{}:{e:e.unref(t.sheep).$url.static("/static/img/shop/goods/score1.svg")},{f:e.t(l.value)}):{g:e.t(e.unref(r.fen2yuan)(i.selectedSku.price||i.goodsInfo.price))},{h:e.t(i.selectedSku.stock||i.goodsInfo.stock),i:e.f(e.unref(d),((t,r,o)=>({a:e.t(t.name),b:e.f(t.values,((r,o,s)=>({a:e.t(r.name),b:e.n({"checked-btn":i.currentPropertyArray[t.id]===r.id}),c:e.n({"disabled-btn":!0===r.disabled}),d:r.id,e:!0===r.disabled,f:e.o((e=>((e,t)=>{let r=!0;void 0!==i.currentPropertyArray[e]&&i.currentPropertyArray[e]===t?(r=!1,i.currentPropertyArray.splice(e,1,"")):i.currentPropertyArray[e]=t;let o=[];i.currentPropertyArray.forEach((e=>{""!==e&&o.push(e)}));let s=y();o.length===d.length&&s.length?(s[0].count=i.selectedSku.count||1,i.selectedSku=s[0]):i.selectedSku={},f(r,e,t)})(t.id,r.id)),r.id)}))),c:t.id}))),j:e.o((e=>{var t;(t=e)>0&&i.selectedSku.count!==t&&(i.selectedSku.count=t)})),k:e.o((e=>i.selectedSku.count=e)),l:e.p({min:1,max:e.unref(e.min)([s.singleLimitCount,i.selectedSku.stock]),step:1,activity:"seckill",modelValue:i.selectedSku.count}),m:e.o(p),n:e.o((e=>n("close"))),o:e.p({show:s.show,round:"10"})})}},u=e._export_sfc(s,[["__scopeId","data-v-f14c63e3"]]);wx.createComponent(u);
