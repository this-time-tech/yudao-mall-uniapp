"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../index.js"),o=require("../../../hooks/useModal.js"),n=require("../../../api/infra/file.js"),r=require("../../../api/member/user.js");if(!Array){(e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const t={__name:"mp-authorization",props:{agreeStatus:{type:Boolean,default:!1}},setup(t){const i=e.computed((()=>a.sheep.$store("user").userInfo)),s=e.ref(null),u=e.reactive({model:{nickname:i.value.nickname,avatar:i.value.avatar},rules:{},disabledStyle:{color:"#999",disableColor:"#fff"}});function l(e){!async function(e){if(!e)return;let{data:a}=await n.FileApi.uploadFile(e);u.model.avatar=a}(e.detail.avatarUrl||"")}async function m(){const{model:e}=u,{nickname:n,avatar:t}=e;if(!n)return void a.sheep.$helper.toast("请输入昵称");if(!t)return void a.sheep.$helper.toast("请选择头像");const{code:i}=await r.UserApi.updateUser({avatar:u.model.avatar,nickname:u.model.nickname});0===i&&(a.sheep.$helper.toast("授权成功"),await a.sheep.$store("user").getInfo(),o.closeAuthModal())}return(o,n)=>({a:e.unref(a.sheep).$url.cdn(u.model.avatar),b:e.o((o=>e.unref(a.sheep).$router.go("/pages/user/info"))),c:e.o(l),d:e.p({name:"avatar",label:"头像"}),e:e.o((e=>u.model.nickname=e)),f:e.p({type:"nickname",placeholder:"请输入昵称",inputBorder:!1,modelValue:u.model.nickname}),g:e.p({name:"nickname",label:"昵称"}),h:e.o(m),i:e.sr(s,"b00d5530-0",{k:"accountLoginRef"}),j:e.o((e=>u.model=e)),k:e.p({rules:u.rules,validateTrigger:"bind",labelWidth:"140",labelAlign:"center",modelValue:u.model})})}},i=e._export_sfc(t,[["__scopeId","data-v-b00d5530"]]);wx.createComponent(i);
